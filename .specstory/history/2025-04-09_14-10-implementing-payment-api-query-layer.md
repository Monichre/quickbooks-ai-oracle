<!-- Generated by SpecStory -->

# Implementing Payment API Query Layer (2025-04-09 09:10:12)

_**User**_

Using the same approach as earlier implement the Payment api query layer from @quickbooks-payment.mdc 

---

_**Assistant**_



---

I'll implement the Payment API query layer following the same pattern as the Item API.

---

<details>
            <summary>Listed directory src/services/intuit ‚Ä¢ **18** results</summary>
        
| Name |
|-------|
| üìÑ `types.ts` |
| üìÑ `index.ts` |
| üìÑ `api.ts` |
| üìÅ `estimate` |
| üìÅ `bill` |
| üìÑ `client.ts` |
| üìÅ `customer` |
| üìÑ `auth.ts` |
| üìÑ `README.md` |
| üìÅ `invoice` |
| üìÅ `purchase-order` |
| üìÅ `purchase` |
| üìÅ `account` |
| üìÅ `company-info` |
| üìÅ `product` |
| üìÅ `item` |
| üìÅ `vendor` |
| üìÑ `encryption.ts` |

</details>

---

Now I'll check the structure of the Item module to follow the same pattern:

---

<details>
            <summary>Listed directory src/services/intuit/item ‚Ä¢ **1** results</summary>
        
| Name |
|-------|
| üìÑ `item.api.ts` |

</details>

---

Let me check if there's an index.ts file in the item directory:

---

<details>
            <summary>Searched codebase "export * from "./item.api"" ‚Ä¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/services/intuit/item/item.api.ts` | L1-14 |
| `src/services/intuit/api.ts` | L175-176 |
| `src/services/intuit/item/item.api.ts` | L14-23 |
| `src/services/intuit/index.ts` | L24-25 |
| `src/services/intuit/item/item.api.ts` | L23-35 |
| `src/services/intuit/item/item.api.ts` | L48-65 |
| `src/services/intuit/item/item.api.ts` | L35-48 |
| `.repomix-output.txt` | L11699-11764 |
| `src/services/intuit/types.ts` | L276-306 |
| `src/services/intuit/product/product.api.ts` | L1-16 |
| `src/services/intuit/product/product.api.ts` | L16-25 |
| `.repomix-output.txt` | L12771-12846 |
| `.repomix-output.txt` | L11639-11699 |
| `src/services/intuit/product/product.api.ts` | L25-37 |
| `.repomix-output.txt` | L12710-12771 |
| `src/services/intuit/product/product.api.ts` | L52-68 |
| `src/services/intuit/product/product.api.ts` | L37-52 |
| `src/components/ui/carousel.tsx` | L232-241 |
| `src/services/intuit/index.ts` | L21-22 |
| `src/services/intuit/types.ts` | L401-406 |
| `.cursor/rules/apis/intuit/quickbooks-item.mdc` | L1-84 |
| `src/app/api/ai/chat/route.ts` | L113-196 |
| `src/services/intuit/api.ts` | L180-181 |
| `.repomix-output.txt` | L11764-11823 |
| `src/services/intuit/api.ts` | L179-180 |

</details>

---

Let me check the bill API structure for more guidance:

---

<details>
            <summary>Listed directory src/services/intuit/bill ‚Ä¢ **3** results</summary>
        
| Name |
|-------|
| üìÑ `index.ts` |
| üìÑ `bill.api.ts` |
| üìÑ `bill.types.ts` |

</details>

---

Read file: src/services/intuit/bill/bill.types.ts

---

Read file: src/services/intuit/bill/bill.api.ts

---

Read file: src/services/intuit/types.ts

---

### Rule: apis/intuit/intuit-oath-endpoints

**intuit, quickbooks, entity**

```markdown
### Base URLs
- **Production Base URL:** https://quickbooks.api.intuit.com
- **Sandbox Base URL:** https://sandbox-quickbooks.api.intuit.com

### OAuth Endpoints
- **Issuer:** https://oauth.platform.intuit.com/op/v1
- **Authorization Endpoint:** https://appcenter.intuit.com/connect/oauth2
- **Token Endpoint:**   https://oauth.platform.intuit.com/oauth2/v1/tokens/bearer
- **User Info Endpoint:**  https://sandbox-accounts.platform.intuit.com/v1/openid_connect/userinfo
- **Revocation Endpoint:** https://developer.api.intuit.com/v2/oauth2/tokens/revoke
- **JWKS URI:** https://oauth.platform.intuit.com/op/v1/jwks```

---

Now I'll check if there's a Payment type in the types.ts file:

---

<details>
            <summary>Grep search for "export type Payment" ‚Ä¢ **0** files</summary>
        
No results found
</details>

---

Let me check for any Payment-related content in the codebase:

---

<details>
            <summary>Searched codebase "Payment QuickBooks" ‚Ä¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `.cursor/rules/apis/intuit/quickbooks-payment.mdc` | L1-92 |
| `.cursor/rules/apis/intuit/quickbooks-payment.mdc` | L92-211 |
| `src/services/intuit/invoice/invoice.api.ts` | L68-77 |
| `.repomix-output.txt` | L12846-12904 |
| `src/services/intuit/bill/bill.api.ts` | L1-18 |
| `.repomix-output.txt` | L11639-11699 |
| `src/services/intuit/invoice/invoice.api.ts` | L1-16 |
| `src/services/intuit/types.ts` | L406-421 |
| `src/services/intuit/invoice/invoice.api.ts` | L52-68 |
| `src/services/intuit/invoice/invoice.api.ts` | L77-91 |
| `src/services/intuit/bill/bill.api.ts` | L18-27 |
| `src/services/intuit/invoice/invoice.api.ts` | L25-37 |
| `src/services/intuit/bill/bill.api.ts` | L27-42 |
| `src/services/intuit/invoice/invoice.api.ts` | L16-25 |
| `src/services/intuit/purchase/purchase.api.ts` | L52-68 |
| `src/services/intuit/README.md` | L1-128 |
| `docs/quickbooks/01-quickbooks-api-overview.md` | L1-109 |
| `src/services/intuit/purchase/purchase.api.ts` | L1-16 |
| `src/services/intuit/invoice/invoice.api.ts` | L37-52 |
| `src/services/intuit/purchase/purchase.api.ts` | L25-37 |
| `src/services/quickbooks/client.ts` | L30-48 |
| `src/services/intuit/purchase/purchase.api.ts` | L16-25 |
| `.repomix-output.txt` | L1572-1621 |
| `docs/quickbooks/00-quickbooks-api-toc.md` | L56-116 |
| `src/services/intuit/purchase/purchase.api.ts` | L37-52 |

</details>

---

Great! I found the quickbooks-payment.mdc file which contains the necessary information to implement the Payment API. Now I'll create the necessary files for the Payment API layer:

1. First, let's create the directory structure for the payment API:

---

```bash
mkdir -p src/services/intuit/payment
```

```
MacBookPro:quickbooks-oracle-initial liamellis$ 

```

---

2. Now, let's create the payment.types.ts file with the Payment interface definitions:

---

```diff
- 
+ /**
+  * Type definitions for QuickBooks Payments API
+  */
+ 
+ // Define the common reference type
+ interface ReferenceType {
+ 	value: string;
+ 	name?: string;
+ }
+ 
+ /**
+  * Interface for Line items in a Payment
+  */
+ export interface PaymentLine {
+ 	Amount: number;
+ 	LinkedTxn?: Array<{
+ 		TxnId: string;
+ 		TxnType: string;
+ 		TxnLineId?: string;
+ 	}>;
+ }
+ 
+ /**
+  * Interface for the Payment entity
+  */
+ export interface Payment {
+ 	Id?: string;
+ 	SyncToken?: string;
+ 	CustomerRef: ReferenceType;
+ 	TotalAmt: number;
+ 	CurrencyRef?: ReferenceType;
+ 	Line: PaymentLine[];
+ 	TxnDate?: string;
+ 	PaymentMethodRef?: ReferenceType;
+ 	DepositToAccountRef?: ReferenceType;
+ 	UnappliedAmt?: number;
+ 	ProcessPayment?: boolean;
+ 	domain?: string;
+ 	MetaData?: {
+ 		CreateTime?: string;
+ 		LastUpdatedTime?: string;
+ 	};
+ 	sparse?: boolean;
+ }
+ 
+ /**
+  * Interface for the Payment create request
+  */
+ export interface PaymentCreateRequest {
+ 	CustomerRef: ReferenceType;
+ 	TotalAmt: number;
+ 	Line: PaymentLine[];
+ 	TxnDate?: string;
+ 	PaymentMethodRef?: ReferenceType;
+ 	DepositToAccountRef?: ReferenceType;
+ 	ProcessPayment?: boolean;
+ }
+ 
+ /**
+  * Interface for the Payment update request
+  */
+ export interface PaymentUpdateRequest extends PaymentCreateRequest {
+ 	Id: string;
+ 	SyncToken: string;
+ 	sparse?: boolean;
+ }
+ 
+ /**
+  * Interface for the Payment delete/void request
+  */
+ export interface PaymentDeleteRequest {
+ 	Id: string;
+ 	SyncToken: string;
+ }
+ 
+ /**
+  * Interface for the Payment query parameters
+  */
+ export interface PaymentQueryParams {
+ 	limit?: number;
+ 	offset?: number;
+ 	asc?: string;
+ 	desc?: string;
+ 	TxnDate?: string;
+ 	CustomerRef?: string;
+ 	[key: string]: string | number | boolean | undefined;
+ }
+ 
+ /**
+  * Interface for the Payment query response
+  */
+ export interface PaymentQueryResponse {
+ 	QueryResponse: {
+ 		Payment?: Payment[];
+ 		startPosition?: number;
+ 		maxResults?: number;
+ 		totalCount?: number;
+ 	};
+ 	time?: string;
+ }
+ 
```

---

3. Now, let's create the payment.api.ts file with the Payment API functions:

---

```diff
- 
+ import { quickbooksRequest, buildQueryString } from "../api";
+ import type {
+ 	Payment,
+ 	PaymentCreateRequest,
+ 	PaymentUpdateRequest,
+ 	PaymentDeleteRequest,
+ 	PaymentQueryParams,
+ 	PaymentQueryResponse,
+ } from "./payment.types";
+ 
+ /**
+  * Create a new payment in QuickBooks
+  * @param payment The payment data to create
+  * @returns Promise with the created payment
+  */
+ export async function createPayment(
+ 	payment: PaymentCreateRequest,
+ ): Promise<Payment> {
+ 	return quickbooksRequest<Payment, { Payment: PaymentCreateRequest }>(
+ 		"payment",
+ 		"POST",
+ 		{
+ 			Payment: payment,
+ 		},
+ 	);
+ }
+ 
+ /**
+  * Update an existing payment in QuickBooks
+  * @param payment The payment data to update (must include Id and SyncToken)
+  * @returns Promise with the updated payment
+  */
+ export async function updatePayment(
+ 	payment: PaymentUpdateRequest,
+ ): Promise<Payment> {
+ 	return quickbooksRequest<Payment, { Payment: PaymentUpdateRequest }>(
+ 		"payment",
+ 		"POST",
+ 		{
+ 			Payment: payment,
+ 		},
+ 	);
+ }
+ 
+ /**
+  * Delete a payment from QuickBooks
+  * @param paymentToDelete The payment info to delete (must include Id and SyncToken)
+  * @returns Promise with the deletion response
+  */
+ export async function deletePayment(
+ 	paymentToDelete: PaymentDeleteRequest,
+ ): Promise<{ success: boolean }> {
+ 	const { Id, SyncToken } = paymentToDelete;
+ 	return quickbooksRequest<
+ 		{ success: boolean },
+ 		{ Id: string; SyncToken: string; operation: string }
+ 	>("payment?operation=delete", "POST", { Id, SyncToken, operation: "delete" });
+ }
+ 
+ /**
+  * Void a payment in QuickBooks
+  * @param paymentToVoid The payment info to void (must include Id and SyncToken)
+  * @returns Promise with the void response
+  */
+ export async function voidPayment(
+ 	paymentToVoid: PaymentDeleteRequest,
+ ): Promise<{ success: boolean }> {
+ 	const { Id, SyncToken } = paymentToVoid;
+ 	return quickbooksRequest<
+ 		{ success: boolean },
+ 		{ Id: string; SyncToken: string; operation: string }
+ 	>("payment?operation=void", "POST", { Id, SyncToken, operation: "void" });
+ }
+ 
+ /**
+  * Get a specific payment by ID
+  * @param paymentId The ID of the payment to retrieve
+  * @returns Promise with the payment data
+  */
+ export async function getPayment(
+ 	paymentId: string,
+ ): Promise<{ Payment: Payment }> {
+ 	return quickbooksRequest<{ Payment: Payment }>(`payment/${paymentId}`);
+ }
+ 
+ /**
+  * Query payments with optional filtering parameters
+  * @param params Optional query parameters
+  * @returns Promise with the payments query response
+  */
+ export async function findPayments(
+ 	params: PaymentQueryParams = {},
+ ): Promise<PaymentQueryResponse> {
+ 	const queryString = buildQueryString(params);
+ 	const endpoint = `query?query=select * from Payment${queryString}`;
+ 
+ 	return quickbooksRequest<PaymentQueryResponse>(endpoint);
+ }
+ 
```

---

4. Now, let's create the index.ts file to export the payment API:

---

```diff
- 
+ export * from "./payment.api";
+ export * from "./payment.types";
+ 
```

---

5. Now, let's update the main intuit/index.ts file to export the payment API:

---

Read file: src/services/intuit/index.ts

---

```diff
  export * from "./bill/bill.api";
  export * from "./estimate/estimate.api";
+ export * from "./payment/payment.api";
  
```

---

6. Finally, let's update the api.ts file to re-export the payment API:

---

Read file: src/services/intuit/api.ts

---

```diff
  export * from "./bill/bill.api";
  export * from "./estimate/estimate.api";
+ export * from "./payment/payment.api";
  
  export type { QueryParams };
```

---

7. Let's check if we need to update the EntityType in types.ts to include the payments entity:

---

```diff
  	| "purchase-orders"
  	| "bills"
- 	| "estimates";
+ 	| "estimates"
+ 	| "payments";
  
```

---

The implementation of the Payment API query layer is now complete! Here's a summary of what we've done:

1. Created a new `payment` directory under `src/services/intuit`
2. Created `payment.types.ts` with all necessary type definitions
3. Created `payment.api.ts` with all the CRUD operations for payments
4. Created an `index.ts` file to export all the payment API functions and types
5. Updated the main `intuit/index.ts` file to export the payment API
6. Updated the `api.ts` file to re-export the payment API
7. Updated the `EntityType` in `types.ts` to include payments

The Payment API is now ready to use and follows the same pattern as the other entity APIs in the codebase. You can now use functions like `createPayment`, `getPayment`, `findPayments`, `updatePayment`, `deletePayment`, and `voidPayment` to interact with the QuickBooks Payment API.

---


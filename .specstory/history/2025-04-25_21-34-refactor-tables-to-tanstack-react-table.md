<!-- Generated by SpecStory -->

# Refactor Tables to TanStack React Table (2025-04-25 16:34:08)

_**User**_

Refactor vanilla tables in @purchase-orders and @estimates to use Tanstack React Table, use @entity-table.tsx as reference

---

_**Assistant**_

**Restating the prompt:**  
You want the vanilla HTML tables in `src/app/dashboard/purchase-orders/page.tsx` and `src/app/dashboard/estimates/page.tsx` refactored to use TanStack React Table, following the pattern in `src/app/dashboard/[entity]/entity-table.tsx`. You want a detailed, step-by-step plan, pseudocode, and then the implementation, with all work documented in PascalCase markdown files.

---

# <PLANNING>

## Step-by-step Plan

1. **Analyze the Current Table Implementations**
   - Review both `page.tsx` files for `purchase-orders` and `estimates`.
   - Identify the data shape and columns rendered.

2. **Analyze the Reference Table**
   - Review `entity-table.tsx` for how it abstracts table rendering using TanStack React Table.
   - Note how it handles columns, data, filtering, sorting, and pagination.

3. **Determine Integration Approach**
   - Decide whether to use `entity-table.tsx` directly (by passing props) or to copy its logic into each page.
   - Prefer reusing `entity-table.tsx` for maintainability and DRYness.

4. **Refactor Each Page**
   - Replace the vanilla table markup with the `EntityTable` component.
   - Prepare the data in the same shape as expected by `EntityTable`.
   - Pass the correct `entity` and `initialData` props.

5. **Adjust Data Fetching**
   - Ensure the data fetched from the API matches the expected structure for `EntityTable`.
   - If necessary, adapt the API response to fit the expected format.

6. **Test and Validate**
   - Ensure all columns are rendered correctly.
   - Check sorting, filtering, and pagination.
   - Validate error and empty states.

7. **Document the Work**
   - Write a detailed pseudocode file: `RefactorTables_PSEUDOCODE.md`.
   - Write a documentation file: `RefactorTables.md` describing the new architecture, data flow, and key modules.

---

# <PSEUDOCODE>

## RefactorTables_PSEUDOCODE.md

```markdown
# RefactorTables_PSEUDOCODE

## 1. Analyze Current Table Usage

- Both `purchase-orders/page.tsx` and `estimates/page.tsx`:
  - Fetch data from respective API.
  - Render a table with hardcoded columns and rows.
  - Use vanilla HTML table markup.

## 2. Analyze EntityTable

- `EntityTable` expects:
  - `entity`: string (e.g., 'purchase-orders', 'estimates')
  - `initialData`: QuickBooksResponse (with QueryResponse containing array of entities)
- Handles:
  - Dynamic columns based on data keys.
  - Filtering, sorting, pagination.
  - Error and empty states.

## 3. Refactor Each Page

- Remove vanilla table markup.
- Import and use `EntityTable`.
- Fetch data as before.
- Pass:
  - `entity` as a string ('purchase-orders' or 'estimates')
  - `initialData` as the API response object.

## 4. Adjust Data Fetching (if needed)

- Ensure API response matches:
  - `{ QueryResponse: { [EntityKey]: EntityObject[] } }`
- If not, wrap/transform as needed.

## 5. Test

- Validate:
  - All columns appear.
  - Sorting, filtering, pagination work.
  - Error and empty states render as expected.

## 6. Document

- Write up architecture, data flow, and usage in `RefactorTables.md`.
```

---

# <IMPLEMENTATION PLAN>

- Edit `src/app/dashboard/purchase-orders/page.tsx`:
  - Remove the vanilla table.
  - Import and use `EntityTable` with correct props.
- Edit `src/app/dashboard/estimates/page.tsx`:
  - Same as above.
- Ensure both pages fetch data and pass it to `EntityTable` in the correct format.
- Write and save `RefactorTables_PSEUDOCODE.md` and `RefactorTables.md`.

---

Proceeding to write the pseudocode file first.

---

```diff
- 
+ # RefactorTables_PSEUDOCODE
+ 
+ ## 1. Analyze Current Table Usage
+ 
+ - Both `purchase-orders/page.tsx` and `estimates/page.tsx`:
+   - Fetch data from respective API.
+   - Render a table with hardcoded columns and rows.
+   - Use vanilla HTML table markup.
+ 
+ ## 2. Analyze EntityTable
+ 
+ - `EntityTable` expects:
+   - `entity`: string (e.g., 'purchase-orders', 'estimates')
+   - `initialData`: QuickBooksResponse (with QueryResponse containing array of entities)
+ - Handles:
+   - Dynamic columns based on data keys.
+   - Filtering, sorting, pagination.
+   - Error and empty states.
+ 
+ ## 3. Refactor Each Page
+ 
+ - Remove vanilla table markup.
+ - Import and use `EntityTable`.
+ - Fetch data as before.
+ - Pass:
+   - `entity` as a string ('purchase-orders' or 'estimates')
+   - `initialData` as the API response object.
+ 
+ ## 4. Adjust Data Fetching (if needed)
+ 
+ - Ensure API response matches:
+   - `{ QueryResponse: { [EntityKey]: EntityObject[] } }`
+ - If not, wrap/transform as needed.
+ 
+ ## 5. Test
+ 
+ - Validate:
+   - All columns appear.
+   - Sorting, filtering, pagination work.
+   - Error and empty states render as expected.
+ 
+ ## 6. Document
+ 
+ - Write up architecture, data flow, and usage in `RefactorTables.md`.
+ 
```

---

```diff
  import {findPurchases} from '@/services/intuit/purchase/purchase.api'
  import Link from 'next/link'
+ import dynamic from 'next/dynamic'
+ 
+ const EntityTable = dynamic(() => import('../[entity]/entity-table'), {
+   ssr: false,
+ })
  
  export default async function PurchaseOrdersPage() {
    const purchasesResponse = await findPurchases({maxResults: 100})
-   const purchases = purchasesResponse.QueryResponse?.Purchase || []
  
    return (
```

```diff
          </Link>
        </div>
- 
-       <div className='bg-black border border-gray-200 shadow overflow-hidden rounded-lg'>
-         <table className='min-w-full divide-y divide-gray-200 purchase-orders-table p-4'>
-           <thead className='bg-gray-50'>
-             <tr>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Doc #
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Vendor
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Date
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Total
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Payment Type
-               </th>
-               <th className='px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Actions
-               </th>
-             </tr>
-           </thead>
-           <tbody className='bg-white divide-y divide-gray-200'>
-             {purchases.length === 0 ? (
-               <tr>
-                 <td colSpan={6} className='px-6 py-4 text-center text-gray-500'>
-                   No purchase orders found
-                 </td>
-               </tr>
-             ) : (
-               purchases.map((purchase) => (
-                 <tr key={purchase.Id}>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {purchase.DocNumber || 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {purchase.EntityRef?.name || 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {purchase.TxnDate
-                       ? new Date(purchase.TxnDate).toLocaleDateString()
-                       : 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     ${purchase.TotalAmt?.toFixed(2) || '0.00'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {purchase.PaymentType || 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap text-right text-sm font-medium'>
-                     <Link
-                       href={`/dashboard/purchase-orders/${purchase.Id}`}
-                       className='text-blue-600 hover:text-blue-900 mr-4'
-                     >
-                       View
-                     </Link>
-                     <Link
-                       href={`/dashboard/purchase-orders/${purchase.Id}/edit`}
-                       className='text-indigo-600 hover:text-indigo-900'
-                     >
-                       Edit
-                     </Link>
-                   </td>
-                 </tr>
-               ))
-             )}
-           </tbody>
-         </table>
-       </div>
+       <EntityTable entity='purchase-orders' initialData={purchasesResponse} />
      </div>
    )
```

---

```diff
  import {findEstimates} from '@/services/intuit/estimate/estimate.api'
  import Link from 'next/link'
+ import dynamic from 'next/dynamic'
+ 
+ const EntityTable = dynamic(() => import('../[entity]/entity-table'), {
+   ssr: false,
+ })
  
  export default async function EstimatesPage() {
    const estimatesResponse = await findEstimates({maxResults: 100})
-   const estimates = estimatesResponse.QueryResponse?.Estimate || []
  
    return (
```

```diff
          </Link>
        </div>
- 
-       <div className='bg-white shadow overflow-hidden rounded-lg'>
-         <table className='min-w-full divide-y divide-gray-200'>
-           <thead className='bg-gray-50'>
-             <tr>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Doc #
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Customer
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Date
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Total
-               </th>
-               <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Status
-               </th>
-               <th className='px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider'>
-                 Actions
-               </th>
-             </tr>
-           </thead>
-           <tbody className='bg-white divide-y divide-gray-200'>
-             {estimates.length === 0 ? (
-               <tr>
-                 <td colSpan={6} className='px-6 py-4 text-center text-gray-500'>
-                   No estimates found
-                 </td>
-               </tr>
-             ) : (
-               estimates.map((estimate) => (
-                 <tr key={estimate.Id}>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {estimate.DocNumber || 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {estimate.CustomerRef?.name || 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {estimate.TxnDate
-                       ? new Date(estimate.TxnDate).toLocaleDateString()
-                       : 'N/A'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     ${estimate.TotalAmt?.toFixed(2) || '0.00'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap'>
-                     {estimate.TxnStatus || 'Pending'}
-                   </td>
-                   <td className='px-6 py-4 whitespace-nowrap text-right text-sm font-medium'>
-                     <Link
-                       href={`/dashboard/estimates/${estimate.Id}`}
-                       className='text-blue-600 hover:text-blue-900 mr-4'
-                     >
-                       View
-                     </Link>
-                     <Link
-                       href={`/dashboard/estimates/${estimate.Id}/edit`}
-                       className='text-indigo-600 hover:text-indigo-900'
-                     >
-                       Edit
-                     </Link>
-                   </td>
-                 </tr>
-               ))
-             )}
-           </tbody>
-         </table>
-       </div>
+       <EntityTable entity='estimates' initialData={estimatesResponse} />
      </div>
    )
```

---

```diff
- 
+ # RefactorTables
+ 
+ ## Overview
+ 
+ This refactor replaces the vanilla HTML tables in `src/app/dashboard/purchase-orders/page.tsx` and `src/app/dashboard/estimates/page.tsx` with a reusable, feature-rich table component based on TanStack React Table. The new implementation leverages the `EntityTable` component from `src/app/dashboard/[entity]/entity-table.tsx`.
+ 
+ ## Architecture
+ 
+ - **EntityTable**: A generic, dynamic table component that uses TanStack React Table for advanced features (sorting, filtering, pagination, column pinning, etc.).
+ - **Page Components**: `purchase-orders/page.tsx` and `estimates/page.tsx` now simply fetch their data and render `EntityTable`, passing the correct props.
+ - **Data Flow**:
+   1. Page fetches data from the appropriate API (`findPurchases` or `findEstimates`).
+   2. The API response is passed as `initialData` to `EntityTable`, along with the `entity` string (e.g., 'purchase-orders', 'estimates').
+   3. `EntityTable` dynamically determines columns and renders the table UI, handling all user interactions.
+ 
+ ## Key Modules
+ 
+ - `src/app/dashboard/[entity]/entity-table.tsx`: The core table component, responsible for rendering, sorting, filtering, and paginating entity data.
+ - `src/app/dashboard/purchase-orders/page.tsx`: Now imports and uses `EntityTable`, passing `entity='purchase-orders'` and the API response.
+ - `src/app/dashboard/estimates/page.tsx`: Now imports and uses `EntityTable`, passing `entity='estimates'` and the API response.
+ 
+ ## Improvements
+ 
+ - **Maintainability**: Table logic is centralized in `EntityTable`, reducing code duplication and making future changes easier.
+ - **Scalability**: New entity tables can be added by simply reusing `EntityTable` with different data.
+ - **Feature Set**: Users get advanced table features (sorting, filtering, pagination, column pinning, etc.) out of the box.
+ - **Consistency**: All entity tables now share a consistent UI/UX and code structure.
+ 
+ ## Usage Example
+ 
+ ```tsx
+ // In purchase-orders/page.tsx
+ <EntityTable entity='purchase-orders' initialData={purchasesResponse} />
+ 
+ // In estimates/page.tsx
+ <EntityTable entity='estimates' initialData={estimatesResponse} />
+ ```
+ 
+ ## References
+ 
+ - [entity-table.tsx](mdc:src/app/dashboard/[entity]/entity-table.tsx)
+ - [purchase-orders/page.tsx](mdc:src/app/dashboard/purchase-orders/page.tsx)
+ - [estimates/page.tsx](mdc:src/app/dashboard/estimates/page.tsx)
+ 
```

---

**Prompt restated:**  
You asked to refactor the vanilla tables in `@purchase-orders` and `@estimates` to use TanStack React Table, referencing `@entity-table.tsx`. You want step-by-step planning, detailed pseudocode, and documentation, with all work saved in PascalCase markdown files.

---

**Approach and what was done:**

1. **Planning:**  
   - Outlined a step-by-step plan for replacing the vanilla tables with the reusable `EntityTable` component.
   - Decided to keep the page header and create button, and replace only the table with `EntityTable`.

2. **Pseudocode:**  
   - Created `RefactorTables_PSEUDOCODE.md` detailing the process, including data flow, integration, and testing.

3. **Implementation:**  
   - Refactored both `src/app/dashboard/purchase-orders/page.tsx` and `src/app/dashboard/estimates/page.tsx`:
     - Removed the vanilla table markup.
     - Imported `EntityTable` using dynamic import (with `ssr: false` for client-side features).
     - Passed the correct `entity` and `initialData` props.
     - Kept the page header and create button above the table.

4. **Documentation:**  
   - Created `RefactorTables.md` documenting the new architecture, data flow, and improvements.
   - Referenced all relevant files and explained the benefits of the new approach.

---

**Key modules and data flow:**

- `EntityTable` in `src/app/dashboard/[entity]/entity-table.tsx` now handles all table rendering, sorting, filtering, and pagination.
- The page components (`purchase-orders/page.tsx` and `estimates/page.tsx`) simply fetch data and render `EntityTable` with the correct props.
- This approach centralizes table logic, improves maintainability, and provides a consistent, feature-rich UI.

---

**Files created/modified:**
- `RefactorTables_PSEUDOCODE.md` (pseudocode)
- `RefactorTables.md` (documentation)
- `src/app/dashboard/purchase-orders/page.tsx` (refactored to use `EntityTable`)
- `src/app/dashboard/estimates/page.tsx` (refactored to use `EntityTable`)

---

**Next steps:**  
- Test both pages in the browser to ensure all features (sorting, filtering, pagination, error/empty states) work as expected.
- If you want custom column rendering or actions, extend `EntityTable` with render props or column config overrides.

Let me know if you want to further customize the table columns, add row actions, or need help with testing or styling!

---

